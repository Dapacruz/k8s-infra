apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: traefik
    namespace: traefik
spec:
    interval: 30m
    chart:
        spec:
            chart: traefik
            version: 35.2.0
            sourceRef:
                kind: HelmRepository
                name: traefik
                namespace: traefik
            interval: 12h
    install:
        crds: Create
    upgrade:
        crds: CreateReplace
    driftDetection:
        mode: enabled
    values:
      ports:
        web:
          redirections:
            entryPoint:
              to: websecure
              scheme: https
              permanent: true
      ingressRoute:
        dashboard:
          # -- Create an IngressRoute for the dashboard
          enabled: false
          # -- Additional ingressRoute annotations (e.g. for kubernetes.io/ingress.class)
          annotations: {}
          # -- Additional ingressRoute labels (e.g. for filtering IngressRoute by custom labels)
          labels: {}
          # -- The router match rule used for the dashboard ingressRoute
          matchRule: PathPrefix(`/dashboard`) || PathPrefix(`/api`)
          # -- The internal service used for the dashboard ingressRoute
          services:
            - name: api@internal
              kind: TraefikService
          # -- Specify the allowed entrypoints to use for the dashboard ingress route, (e.g. traefik, web, websecure).
          # By default, it's using traefik entrypoint, which is not exposed.
          # /!\ Do not expose your dashboard without any protection over the internet /!\
          entryPoints: ["web", "websecure"]
          # -- Additional ingressRoute middlewares (e.g. for authentication)
          middlewares: []
          # -- TLS options (e.g. secret containing certificate)
          tls: {}

